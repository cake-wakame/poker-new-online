<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ã‚«ãƒ¼ã‚²ãƒ¼ãƒ  - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .status {
            text-align: center;
            font-size: 1.3em;
            padding: 15px;
            background: #3498db;
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status.waiting {
            background: #f39c12;
        }

        .status.playing {
            background: #27ae60;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
        }

        .info-item {
            font-size: 1.2em;
            font-weight: bold;
        }

        .chips {
            color: #27ae60;
        }

        .bet {
            color: #e74c3c;
        }

        .player-area {
            margin: 20px 0;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
        }

        .player-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .opponent-title {
            color: #e74c3c;
        }

        .player-title-player {
            color: #3498db;
        }

        .hand-info {
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 10px;
            min-height: 30px;
            font-weight: bold;
            color: #7f8c8d;
        }

        .cards-area {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            min-height: 160px;
            flex-wrap: wrap;
        }

        .card {
            width: 90px;
            height: 130px;
            background: white;
            border: 3px solid #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .card.back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: default;
        }

        .card.back::after {
            content: 'ğŸƒ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
        }

        .card:not(.back):hover {
            transform: translateY(-10px);
        }

        .card.selected {
            transform: translateY(-20px);
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.5);
            border-color: #e74c3c;
        }

        .card.hearts, .card.diamonds {
            color: #e74c3c;
        }

        .card.clubs, .card.spades {
            color: #333;
        }

        .card-top, .card-bottom {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .card-bottom {
            align-self: flex-end;
            transform: rotate(180deg);
        }

        .card-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8em;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: #27ae60;
        }

        .btn-secondary {
            background: #3498db;
        }

        .btn-bet {
            background: #f39c12;
        }

        .bet-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .bet-input {
            padding: 10px;
            font-size: 1.1em;
            border: 2px solid #3498db;
            border-radius: 5px;
            width: 150px;
        }

        .result {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            background: #ecf0f1;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result.win {
            background: #2ecc71;
            color: white;
        }

        .result.lose {
            background: #e74c3c;
            color: white;
        }

        .result.draw {
            background: #95a5a6;
            color: white;
        }

        .hidden {
            display: none;
        }

        .hands-reference {
            margin-top: 30px;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 10px;
        }

        .hands-reference h2 {
            color: #1e3c72;
            margin-bottom: 15px;
            text-align: center;
        }

        .hand-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .hand-item {
            padding: 15px;
            background: white;
            border-radius: 5px;
            border-left: 5px solid #3498db;
        }

        .hand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .hand-name {
            font-weight: bold;
            font-size: 1.2em;
            color: #1e3c72;
        }

        .hand-rank {
            color: #3498db;
            font-weight: bold;
            font-size: 1.1em;
        }

        .hand-description {
            color: #555;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .hand-example {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
            font-weight: bold;
        }

        .timer-display {
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            padding: 15px;
            background: #3498db;
            color: white;
            border-radius: 10px;
            margin: 20px 0;
        }

        .timer-display.warning {
            background: #f39c12;
        }

        .timer-display.danger {
            background: #e74c3c;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .draw-counter {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 10px 0;
            color: #2c3e50;
        }

        .draw-counter .remaining {
            color: #27ae60;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸƒ ãƒãƒ¼ã‚«ãƒ¼ã‚²ãƒ¼ãƒ  - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ ğŸƒ</h1>
        
        <div class="status" id="status">ãƒãƒƒãƒãƒ³ã‚°å¾…æ©Ÿä¸­...</div>

        <div id="matchingScreen">
            <div class="controls">
                <button class="btn-primary" onclick="findMatch()">å¯¾æˆ¦ç›¸æ‰‹ã‚’æ¢ã™</button>
            </div>
        </div>

        <div id="gameScreen" class="hidden">
            <div id="timerDisplay" class="timer-display hidden">
                æ®‹ã‚Šæ™‚é–“: <span id="timerValue">5:00</span>
            </div>

            <div class="game-info">
                <div class="info-item">
                    ãƒãƒƒãƒ—: <span class="chips" id="chips">1000</span>
                </div>
                <div class="info-item">
                    ç¾åœ¨ã®ãƒ™ãƒƒãƒˆ: <span class="bet" id="currentBet">0</span>
                </div>
            </div>

            <div id="drawCounter" class="draw-counter hidden">
                æ®‹ã‚Šãƒ‰ãƒ­ãƒ¼å›æ•°: <span class="remaining" id="remainingDraws">3</span> / 3
            </div>

            <div id="bettingControls" class="bet-controls hidden">
                <input type="number" class="bet-input" id="betAmount" min="10" max="1000" value="10" step="10">
                <button class="btn-bet" onclick="placeBet()">ãƒ™ãƒƒãƒˆ</button>
                <button class="btn-bet" onclick="quickBet(50)">50</button>
                <button class="btn-bet" onclick="quickBet(100)">100</button>
                <button class="btn-bet" onclick="quickBet(500)">500</button>
            </div>

            <div class="result" id="result"></div>

            <div class="player-area">
                <div class="player-title opponent-title">ğŸ‘¥ å¯¾æˆ¦ç›¸æ‰‹</div>
                <div class="hand-info" id="opponentHandInfo"></div>
                <div class="cards-area" id="opponentCardsArea"></div>
            </div>

            <div class="player-area">
                <div class="player-title player-title-player">ğŸ‘¤ ã‚ãªãŸ</div>
                <div class="hand-info" id="playerHandInfo"></div>
                <div class="cards-area" id="playerCardsArea"></div>
            </div>

            <div class="controls">
                <button class="btn-secondary" id="drawBtn" onclick="draw()" disabled>ãƒ‰ãƒ­ãƒ¼ï¼ˆé¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›ï¼‰</button>
                <button class="btn-secondary" id="skipBtn" onclick="skipDraw()" style="display:none;">ãƒ‰ãƒ­ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—</button>
            </div>
        </div>

        <div class="hands-reference">
            <h2>å½¹ä¸€è¦§ã¨èª¬æ˜ï¼ˆå¼·ã„é †ï¼‰</h2>
            <div class="hand-list">
                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span>
                        <span class="hand-rank">æœ€å¼·</span>
                    </div>
                    <div class="hand-description">
                        åŒã˜ã‚¹ãƒ¼ãƒˆï¼ˆãƒãƒ¼ã‚¯ï¼‰ã®10ã€Jã€Qã€Kã€AãŒæƒã£ãŸçŠ¶æ…‹ã€‚ãƒãƒ¼ã‚«ãƒ¼ã®æœ€å¼·å½¹ã§ã€å‡ºç¾ç¢ºç‡ã¯ç´„0.00015%ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ 10 â™ J â™ Q â™ K â™ A</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span>
                        <span class="hand-rank">9</span>
                    </div>
                    <div class="hand-description">
                        åŒã˜ã‚¹ãƒ¼ãƒˆã§æ•°å­—ãŒé€£ç¶šã—ã¦ã„ã‚‹5æšã®ã‚«ãƒ¼ãƒ‰ã€‚ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ä»¥å¤–ã®é€£ç¶šã—ãŸåŒä¸€ã‚¹ãƒ¼ãƒˆã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™¥5 â™¥6 â™¥7 â™¥8 â™¥9</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰</span>
                        <span class="hand-rank">8</span>
                    </div>
                    <div class="hand-description">
                        åŒã˜æ•°å­—ã®ã‚«ãƒ¼ãƒ‰ãŒ4æšæƒã£ãŸçŠ¶æ…‹ã€‚åˆ¥åã€Œãƒ•ã‚©ãƒ¼ãƒ»ã‚ªãƒ–ãƒ»ã‚¢ãƒ»ã‚«ã‚¤ãƒ³ãƒ‰ã€ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ 7 â™¥7 â™¦7 â™£7 â™ K</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒ•ãƒ«ãƒã‚¦ã‚¹</span>
                        <span class="hand-rank">7</span>
                    </div>
                    <div class="hand-description">
                        ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï¼ˆ3æšï¼‰ã¨ãƒ¯ãƒ³ãƒšã‚¢ï¼ˆ2æšï¼‰ã®çµ„ã¿åˆã‚ã›ã€‚åŒã˜æ•°å­—ãŒ3æšã¨åˆ¥ã®æ•°å­—ãŒ2æšã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ 9 â™¥9 â™¦9 â™£4 â™ 4</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span>
                        <span class="hand-rank">6</span>
                    </div>
                    <div class="hand-description">
                        5æšã™ã¹ã¦ãŒåŒã˜ã‚¹ãƒ¼ãƒˆï¼ˆãƒãƒ¼ã‚¯ï¼‰ã®ã‚«ãƒ¼ãƒ‰ã€‚æ•°å­—ã¯é€£ç¶šã—ã¦ã„ãªãã¦ã‚‚ã‚ˆã„ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™¦2 â™¦5 â™¦8 â™¦J â™¦K</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ</span>
                        <span class="hand-rank">5</span>
                    </div>
                    <div class="hand-description">
                        5æšã®ã‚«ãƒ¼ãƒ‰ã®æ•°å­—ãŒé€£ç¶šã—ã¦ã„ã‚‹çŠ¶æ…‹ã€‚ã‚¹ãƒ¼ãƒˆã¯ãƒãƒ©ãƒãƒ©ã§ã‚‚ã‚ˆã„ã€‚A-2-3-4-5ã‚‚èªã‚ã‚‰ã‚Œã‚‹ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ 6 â™¥7 â™¦8 â™£9 â™ 10</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</span>
                        <span class="hand-rank">4</span>
                    </div>
                    <div class="hand-description">
                        åŒã˜æ•°å­—ã®ã‚«ãƒ¼ãƒ‰ãŒ3æšæƒã£ãŸçŠ¶æ…‹ã€‚åˆ¥åã€Œã‚¹ãƒªãƒ¼ãƒ»ã‚ªãƒ–ãƒ»ã‚¢ãƒ»ã‚«ã‚¤ãƒ³ãƒ‰ã€ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ Q â™¥Q â™¦Q â™£3 â™ 7</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒ„ãƒ¼ãƒšã‚¢</span>
                        <span class="hand-rank">3</span>
                    </div>
                    <div class="hand-description">
                        ç•°ãªã‚‹æ•°å­—ã®ãƒšã‚¢ï¼ˆ2æšçµ„ï¼‰ãŒ2çµ„ã‚ã‚‹çŠ¶æ…‹ã€‚ä¾‹ãˆã°8ã®ãƒšã‚¢ã¨3ã®ãƒšã‚¢ãªã©ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ J â™¥J â™¦5 â™£5 â™ 2</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒ¯ãƒ³ãƒšã‚¢</span>
                        <span class="hand-rank">2</span>
                    </div>
                    <div class="hand-description">
                        åŒã˜æ•°å­—ã®ã‚«ãƒ¼ãƒ‰ãŒ2æšã ã‘ã‚ã‚‹çŠ¶æ…‹ã€‚æœ€ã‚‚åŸºæœ¬çš„ãªå½¹ã§ã€å‡ºç¾é »åº¦ãŒé«˜ã„ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ A â™¥A â™¦8 â™£4 â™ 2</div>
                </div>

                <div class="hand-item">
                    <div class="hand-header">
                        <span class="hand-name">ãƒã‚¤ã‚«ãƒ¼ãƒ‰</span>
                        <span class="hand-rank">1</span>
                    </div>
                    <div class="hand-description">
                        ä¸Šè¨˜ã®ã©ã®å½¹ã‚‚æˆç«‹ã—ã¦ã„ãªã„çŠ¶æ…‹ã€‚5æšã®ä¸­ã§æœ€ã‚‚æ•°å­—ãŒå¤§ãã„ã‚«ãƒ¼ãƒ‰ã§å‹è² ã™ã‚‹ã€‚
                    </div>
                    <div class="hand-example">ä¾‹: â™ K â™¥10 â™¦7 â™£5 â™ 2ï¼ˆKãƒã‚¤ï¼‰</div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; text-align: center;">
                <strong>é…å½“:</strong> å‹åˆ© = ãƒ™ãƒƒãƒˆé¡ã®2å€ç²å¾— | å¼•ãåˆ†ã‘ = ãƒ™ãƒƒãƒˆé¡è¿”å´ | æ•—åŒ— = æ²¡å
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const suitSymbols = {
            'hearts': 'â™¥',
            'diamonds': 'â™¦',
            'clubs': 'â™£',
            'spades': 'â™ '
        };

        let roomId = null;
        let playerId = null;
        let chips = 1000;
        let currentBet = 0;
        let selectedCards = new Set();
        let playerHand = [];
        let opponentHand = [];
        let timerInterval = null;
        let remainingTime = 0;
        let currentPhase = '';
        let remainingDraws = 3;

        function findMatch() {
            socket.emit('findMatch');
            updateStatus('å¯¾æˆ¦ç›¸æ‰‹ã‚’æ¢ã—ã¦ã„ã¾ã™...', 'waiting');
        }

        socket.on('waiting', () => {
            updateStatus('å¯¾æˆ¦ç›¸æ‰‹ã‚’æ¢ã—ã¦ã„ã¾ã™...', 'waiting');
        });

        socket.on('matchFound', (data) => {
            roomId = data.roomId;
            playerId = data.playerId;
            updateStatus('å¯¾æˆ¦ç›¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼', 'playing');
            
            document.getElementById('matchingScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('bettingControls').classList.remove('hidden');
            document.getElementById('result').textContent = 'ãƒ™ãƒƒãƒˆã—ã¦ãã ã•ã„';
            document.getElementById('drawCounter').classList.add('hidden');
        });

        socket.on('timerStarted', ({ phase, timeLimit, startTime }) => {
            currentPhase = phase;
            const elapsed = Date.now() - startTime;
            remainingTime = Math.max(0, timeLimit - elapsed);
            startTimer();
        });

        socket.on('betPlaced', ({ chips: newChips, bet }) => {
            chips = newChips;
            currentBet = bet;
            updateDisplay();
            updateStatus('ç›¸æ‰‹ã®ãƒ™ãƒƒãƒˆã‚’å¾…ã£ã¦ã„ã¾ã™...', 'playing');
            document.getElementById('bettingControls').classList.add('hidden');
        });

        socket.on('cardsDealt', ({ hand, drawCount, remainingDraws: remaining }) => {
            playerHand = hand;
            selectedCards.clear();
            remainingDraws = remaining;
            displayCards();
            updateStatus('ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›ã—ã¦ãã ã•ã„', 'playing');
            document.getElementById('drawBtn').disabled = false;
            document.getElementById('drawCounter').classList.remove('hidden');
            document.getElementById('remainingDraws').textContent = remainingDraws;
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('result').textContent = 'äº¤æ›ã—ãŸã„ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§3å›ã¾ã§äº¤æ›å¯èƒ½ï¼‰';
        });

        socket.on('cardsDrawn', ({ hand, drawCount, remainingDraws: remaining }) => {
            playerHand = hand;
            selectedCards.clear();
            remainingDraws = remaining;
            displayCards();
            document.getElementById('remainingDraws').textContent = remainingDraws;
            
            if (remainingDraws > 0) {
                updateStatus(`ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›ã—ã¦ãã ã•ã„ï¼ˆæ®‹ã‚Š${remainingDraws}å›ï¼‰`, 'playing');
                document.getElementById('drawBtn').disabled = false;
                document.getElementById('result').textContent = `äº¤æ›å®Œäº†ï¼æ®‹ã‚Š${remainingDraws}å›äº¤æ›ã§ãã¾ã™`;
            } else {
                updateStatus('ç›¸æ‰‹ã®ãƒ‰ãƒ­ãƒ¼ã‚’å¾…ã£ã¦ã„ã¾ã™...', 'playing');
                document.getElementById('drawBtn').disabled = true;
                document.getElementById('skipBtn').style.display = 'none';
                document.getElementById('result').textContent = 'ãƒ‰ãƒ­ãƒ¼å®Œäº†ï¼ç›¸æ‰‹ã‚’å¾…ã£ã¦ã„ã¾ã™...';
            }
        });

        socket.on('drawSkipped', () => {
            updateStatus('ãƒ‰ãƒ­ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ', 'playing');
            document.getElementById('drawBtn').disabled = true;
            document.getElementById('skipBtn').style.display = 'none';
        });

        socket.on('drawError', (message) => {
            alert(message);
        });

        socket.on('gameResult', (data) => {
            stopTimer();
            opponentHand = data.opponentHand;
            playerHand = data.yourHand;
            chips = data.chips;
            
            displayCards();
            
            document.getElementById('playerHandInfo').textContent = data.yourHandName;
            document.getElementById('opponentHandInfo').textContent = data.opponentHandName;
            document.getElementById('drawCounter').classList.add('hidden');
            document.getElementById('skipBtn').style.display = 'none';
            
            const resultDiv = document.getElementById('result');
            let resultMessage = '';
            
            if (data.reason) {
                resultMessage = `ã€${data.reason}ã€‘ `;
            }
            
            if (data.winner === 'you') {
                resultMessage += `å‹åˆ©ï¼ ${data.yourHandName}ã§${data.pot}ãƒãƒƒãƒ—ç²å¾—ï¼`;
                resultDiv.className = 'result win';
                updateStatus('ã‚ãªãŸã®å‹åˆ©ï¼', 'playing');
            } else if (data.winner === 'draw') {
                resultMessage += `å¼•ãåˆ†ã‘ï¼ ãƒ™ãƒƒãƒˆé¡ã‚’è¿”å´`;
                resultDiv.className = 'result draw';
                updateStatus('å¼•ãåˆ†ã‘', 'playing');
            } else {
                resultMessage += `æ•—åŒ—... ç›¸æ‰‹ã®${data.opponentHandName}ã«è² ã‘ã¾ã—ãŸ`;
                resultDiv.className = 'result lose';
                updateStatus('æ•—åŒ—...', 'playing');
            }
            
            resultDiv.textContent = resultMessage;
            currentBet = 0;
            updateDisplay();
            
            setTimeout(() => {
                document.getElementById('bettingControls').classList.remove('hidden');
                document.getElementById('result').textContent = 'ãƒ™ãƒƒãƒˆã—ã¦ãã ã•ã„';
                document.getElementById('result').className = 'result';
                document.getElementById('playerHandInfo').textContent = '';
                document.getElementById('opponentHandInfo').textContent = '';
                document.getElementById('playerCardsArea').innerHTML = '';
                document.getElementById('opponentCardsArea').innerHTML = '';
                playerHand = [];
                opponentHand = [];
                remainingDraws = 3;
                updateStatus('æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰æº–å‚™ä¸­', 'playing');
            }, 5000);
        });

        socket.on('opponentDisconnected', () => {
            updateStatus('å¯¾æˆ¦ç›¸æ‰‹ãŒåˆ‡æ–­ã—ã¾ã—ãŸ', '');
            alert('å¯¾æˆ¦ç›¸æ‰‹ãŒåˆ‡æ–­ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒãƒ³ã‚°ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚');
            location.reload();
        });

        socket.on('betRefund', ({ refund, chips: newChips, bet }) => {
            chips = newChips;
            currentBet = bet;
            updateDisplay();
            alert(`ãƒ™ãƒƒãƒˆé¡ãŒç•°ãªã‚‹ãŸã‚ã€${refund}ãƒãƒƒãƒ—ãŒè¿”å´ã•ã‚Œã¾ã—ãŸã€‚`);
        });

        socket.on('betError', (message) => {
            alert(message);
        });

        function placeBet() {
            const betAmount = parseInt(document.getElementById('betAmount').value);
            if (betAmount < 10) {
                alert('æœ€ä½ãƒ™ãƒƒãƒˆé¡ã¯10ãƒãƒƒãƒ—ã§ã™');
                return;
            }
            if (betAmount > chips) {
                alert('ãƒãƒƒãƒ—ãŒè¶³ã‚Šã¾ã›ã‚“');
                return;
            }
            socket.emit('placeBet', { roomId, betAmount });
        }

        function quickBet(amount) {
            document.getElementById('betAmount').value = amount;
            placeBet();
        }

        function draw() {
            const indices = Array.from(selectedCards);
            socket.emit('drawCards', { roomId, indices });
        }

        function skipDraw() {
            if (confirm('ãƒ‰ãƒ­ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã‹ï¼Ÿï¼ˆã“ã‚Œä»¥ä¸Šã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›ã§ããªããªã‚Šã¾ã™ï¼‰')) {
                socket.emit('skipDraw', { roomId });
            }
        }

        function startTimer() {
            stopTimer();
            document.getElementById('timerDisplay').classList.remove('hidden');
            
            timerInterval = setInterval(() => {
                remainingTime -= 1000;
                
                if (remainingTime <= 0) {
                    stopTimer();
                    return;
                }
                
                updateTimerDisplay();
            }, 1000);
            
            updateTimerDisplay();
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timerDisplay').classList.add('hidden');
        }

        function updateTimerDisplay() {
            const seconds = Math.floor(remainingTime / 1000);
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            
            const timeString = `${minutes}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('timerValue').textContent = timeString;
            
            const timerDiv = document.getElementById('timerDisplay');
            timerDiv.className = 'timer-display';
            
            if (seconds <= 60) {
                timerDiv.classList.add('danger');
            } else if (seconds <= 120) {
                timerDiv.classList.add('warning');
            }
        }

        function toggleCardSelection(index) {
            if (selectedCards.has(index)) {
                selectedCards.delete(index);
            } else {
                selectedCards.add(index);
            }
            displayCards();
        }

        function displayCards() {
            const playerArea = document.getElementById('playerCardsArea');
            const opponentArea = document.getElementById('opponentCardsArea');
            
            playerArea.innerHTML = '';
            opponentArea.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const cardDiv = createCardElement(card, index, true);
                playerArea.appendChild(cardDiv);
            });
            
            if (opponentHand.length > 0) {
                opponentHand.forEach((card, index) => {
                    const cardDiv = createCardElement(card, index, false);
                    opponentArea.appendChild(cardDiv);
                });
            } else {
                for (let i = 0; i < 5; i++) {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card back';
                    opponentArea.appendChild(cardDiv);
                }
            }
        }

        function createCardElement(card, index, isPlayerCard) {
            const cardDiv = document.createElement('div');
            cardDiv.className = `card ${card.suit}`;
            
            if (isPlayerCard && selectedCards.has(index)) {
                cardDiv.className += ' selected';
            }
            
            if (isPlayerCard && !document.getElementById('drawBtn').disabled) {
                cardDiv.onclick = () => toggleCardSelection(index);
            }
            
            cardDiv.innerHTML = `
                <div class="card-top">
                    <span>${card.rank}</span>
                    <span>${suitSymbols[card.suit]}</span>
                </div>
                <div class="card-center">${suitSymbols[card.suit]}</div>
                <div class="card-bottom">
                    <span>${card.rank}</span>
                    <span>${suitSymbols[card.suit]}</span>
                </div>
            `;
            
            return cardDiv;
        }

        function updateDisplay() {
            document.getElementById('chips').textContent = chips;
            document.getElementById('currentBet').textContent = currentBet;
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        updateDisplay();
    </script>
</body>
</html>
